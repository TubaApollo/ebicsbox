FROM ruby:3.3.2-slim

RUN apt-get update && apt-get install -y \
    git \
    build-essential \
    zlib1g-dev \
    libpq-dev \
    curl \
    && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /usr/ebicsbox /srv/epics-gem
WORKDIR /usr/ebicsbox

# Install bundler
RUN gem install bundler -v 2.3.22

# Copy everything (bundle install happens at runtime when volumes are mounted)
COPY . .

# Make start scripts executable
RUN chmod +x bin/start bin/start-dev

EXPOSE 5000

CMD ["bin/start", "all"]
